<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ferrule Designer Pro | Precision Manufacturing</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: #111; color: #eee; min-height: 100vh;
            display: flex; justify-content: center; align-items: center; padding: 15px;
        }
        #lock-screen {
            position: fixed; inset: 0; background: #000; z-index: 10000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        #lock-screen input { padding: 15px; border-radius: 8px; border: 1px solid #444; background: #222; color: #fff; text-align: center; margin-bottom: 20px; font-size: 1.2rem; }
        
        .container {
            width: 100%; max-width: 1400px; height: 95vh;
            background: #222; border-radius: 12px;
            display: none; grid-template-columns: 460px 1fr;
            overflow: hidden; border: 1px solid #333;
        }
        
        .sidebar { padding: 20px; background: #2a2a2a; border-right: 1px solid #333; overflow-y: auto; }
        h2 { font-size: 0.85rem; margin-bottom: 12px; color: #f1c40f; text-transform: uppercase; letter-spacing: 1.5px; border-bottom: 1px solid #444; padding-bottom: 5px; }
        
        .metallic-palette {
            background: #1a1a1a; padding: 15px; border-radius: 8px; 
            margin-bottom: 20px; border: 1px solid #444;
        }
        .m-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .m-swatch { 
            height: 42px; border-radius: 4px; cursor: pointer; border: 2px solid #333; 
            display: flex; align-items: center; justify-content: center; font-size: 0.55rem; font-weight: bold;
            transition: all 0.2s; text-align: center; position: relative;
        }
        .m-swatch:hover { transform: scale(1.08); border-color: #f1c40f; box-shadow: 0 0 15px rgba(241, 196, 15, 0.3); z-index: 10; }
        .m-swatch:active { transform: scale(0.95); }

        .quick-actions {
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 20px;
        }
        .quick-btn {
            padding: 8px; background: #333; border: 1px solid #444; border-radius: 6px;
            cursor: pointer; font-size: 0.7rem; text-transform: uppercase; font-weight: bold;
            transition: 0.2s; color: #aaa; text-align: center;
        }
        .quick-btn:hover { background: #444; color: #f1c40f; border-color: #f1c40f; }

        #sectionControls { max-height: 400px; overflow-y: auto; padding-right: 10px; margin-bottom: 20px; }
        .section-row { 
            display: flex; align-items: center; gap: 8px; margin-bottom: 6px; 
            background: #333; padding: 6px; border-radius: 4px; border: 1px solid transparent;
            transition: 0.2s;
        }
        .section-row:hover { background: #3a3a3a; border-color: #555; }
        .section-row.selected { border-color: #f1c40f; background: #3a3a3a; }
        .section-row input[type="color"] { width: 35px; height: 35px; border: none; cursor: pointer; background: none; border-radius: 4px; }
        .section-row input[type="text"] { 
            width: 85px; padding: 6px; background: #111; border: 1px solid #444; 
            color: #fff; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 0.8rem;
        }
        .section-row input[type="text"]:focus { border-color: #f1c40f; outline: none; }
        .pantone-tag { 
            flex: 1; font-size: 0.65rem; color: #bbb; text-align: right; 
            overflow: hidden; white-space: nowrap; font-weight: 500;
        }
        .pantone-tag.exact { color: #2ecc71; }
        .pantone-tag.close { color: #f39c12; }
        .pantone-tag.approx { color: #e74c3c; }

        .dim-controls { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
        .dim-box { background: #1a1a1a; padding: 10px; border-radius: 6px; border: 1px solid #444; }
        .dim-box label { font-size: 0.6rem; color: #888; text-transform: uppercase; display: block; margin-bottom: 4px; }
        .dim-box input { width: 100%; padding: 6px; background: #000; border: 1px solid #333; color: #fff; border-radius: 4px; font-size: 0.9rem; }
        .dim-box input:focus { border-color: #f1c40f; outline: none; }

        .viewport { 
            background: radial-gradient(circle, #2a2a2a 0%, #050505 100%); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px; position: relative; 
        }
        .ferrule-viz { 
            width: 320px; height: 480px; display: flex; flex-direction: column; 
            transition: clip-path 0.4s ease; box-shadow: 0 0 50px rgba(0,0,0,0.5);
            cursor: pointer;
        }
        .sec-slice { 
            flex: 1; width: 100%; border-bottom: 0.1px solid rgba(255,255,255,0.02); 
            cursor: pointer; transition: opacity 0.2s;
        }
        .sec-slice:hover { opacity: 0.8; }
        .sec-slice.selected { outline: 2px solid #f1c40f; outline-offset: -2px; z-index: 100; }
        
        .spec-footer { 
            position: absolute; bottom: 20px; width: 90%; background: rgba(0,0,0,0.85); 
            padding: 15px; border-radius: 8px; border: 1px solid #444; display: flex; justify-content: space-between; align-items: center;
        }
        .sku-val { font-family: 'Courier New', monospace; font-size: 1.5rem; color: #f1c40f; font-weight: bold; }
        
        .btn { padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; text-transform: uppercase; margin-top: 10px; width: 100%; transition: 0.2s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .btn-save { background: #27ae60; color: #fff; }
        .btn-save:hover { background: #2ecc71; }
        .btn-reset { background: #444; color: #aaa; margin-top: 5px; }
        .btn-reset:hover { background: #555; color: #fff; }

        .tooltip {
            position: absolute; background: rgba(0,0,0,0.95); color: #fff; padding: 8px 12px;
            border-radius: 6px; font-size: 0.75rem; pointer-events: none; z-index: 1000;
            border: 1px solid #f1c40f; display: none; white-space: nowrap;
        }

        .notification {
            position: fixed; top: 20px; right: 20px; background: #27ae60; color: #fff;
            padding: 12px 20px; border-radius: 6px; font-weight: bold; z-index: 9999;
            animation: slideIn 0.3s ease, slideOut 0.3s ease 2.7s forwards;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(400px); opacity: 0; } }
    </style>
</head>
<body>

    <div id="lock-screen">
        <h1 style="margin-bottom:20px; letter-spacing:4px; color:#f1c40f;">SECURE ACCESS</h1>
        <input type="password" id="pw" placeholder="Enter Password">
        <button class="btn" onclick="unlock()" style="width:220px; background:#fff; color:#000;">Authorize</button>
        <p style="margin-top:10px; color:#666; font-size:0.8rem;">Hint: 4-letter sport</p>
    </div>

    <div class="container" id="app">
        <div class="sidebar">
            <div class="metallic-palette">
                <h2>Metallic Reference Box</h2>
                <div class="m-grid">
                    <div class="m-swatch" style="background:#84754e; color:#fff;" data-hex="#84754E" title="Click to apply">871 C<br>GOLD</div>
                    <div class="m-swatch" style="background:#a68966; color:#fff;" data-hex="#A68966" title="Click to apply">872 C<br>RICH</div>
                    <div class="m-swatch" style="background:#8a8d8f; color:#000;" data-hex="#8A8D8F" title="Click to apply">877 C<br>SILVER</div>
                    <div class="m-swatch" style="background:#d5d2d1; color:#000;" data-hex="#D5D2D1" title="Click to apply">8001 C<br>PLAT</div>
                    <div class="m-swatch" style="background:#915520; color:#fff;" data-hex="#915520" title="Click to apply">876 C<br>COPPER</div>
                    <div class="m-swatch" style="background:#54585a; color:#fff;" data-hex="#54585A" title="Click to apply">8003 C<br>GUN</div>
                    <div class="m-swatch" style="background:#7a6a4f; color:#fff;" data-hex="#7A6A4F" title="Click to apply">873 C<br>BRONZE</div>
                    <div class="m-swatch" style="background:#81d8d0; color:#000;" data-hex="#81D8D0" title="Click to apply">TIFFANY<br>BLUE</div>
                </div>
            </div>

            <div class="quick-actions">
                <div class="quick-btn" onclick="applyPattern('gradient')">Gradient Fill</div>
                <div class="quick-btn" onclick="applyPattern('alternate')">Alternating</div>
                <div class="quick-btn" onclick="applyPattern('triple')">Triple Stripe</div>
                <div class="quick-btn" onclick="copyAllColors()">Copy All Hex</div>
            </div>

            <h2>Section Color Configuration</h2>
            <div id="sectionControls"></div>
            
            <h2>Manufacturing Geometry</h2>
            <div class="dim-controls">
                <div class="dim-box"><label>Length (mm)</label><input type="number" id="len" value="25" min="10" max="50"></div>
                <div class="dim-box"><label>Internal Ã˜ (mm)</label><input type="number" id="wall" value="8.5" step="0.1" min="5" max="20"></div>
                <div class="dim-box"><label>Top Ã˜ (mm)</label><input type="number" id="topD" value="10.5" step="0.1" min="5" max="20"></div>
                <div class="dim-box"><label>Bottom Ã˜ (mm)</label><input type="number" id="botD" value="14.5" step="0.1" min="5" max="25"></div>
            </div>
            
            <button class="btn btn-save" onclick="downloadSpec()">ðŸ“¥ Download Production Spec</button>
            <button class="btn btn-reset" onclick="resetDesigner()">ðŸ”„ Reset Designer</button>
        </div>
        
        <div class="viewport">
            <div class="ferrule-viz" id="preview"></div>
            
            <div class="spec-footer">
                <div>
                    <div style="font-size: 0.6rem; color: #888;">BUILD SKU</div>
                    <div id="skuDisplay" class="sku-val">F-25-XXXX</div>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 0.6rem; color: #888;">SECTIONS</div>
                    <div style="font-weight: bold; color:#fff;">20 Layers</div>
                </div>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        const TOTAL_SECS = 20;
        let activeColors = Array(TOTAL_SECS).fill('#000000');
        let currentID = "";
        let selectedSection = null;

        // Enhanced Pantone database with comprehensive 200+ colors
        const PANTONE_DB = {
            // Metallics - Extended
            '#84754e': { name: '871 C', desc: 'Gold', category: 'metallic' },
            '#a68966': { name: '872 C', desc: 'Rich Gold', category: 'metallic' },
            '#7a6a4f': { name: '873 C', desc: 'Bronze Gold', category: 'metallic' },
            '#74622e': { name: '874 C', desc: 'Antique Gold', category: 'metallic' },
            '#8a8d8f': { name: '877 C', desc: 'Silver', category: 'metallic' },
            '#b1b3b3': { name: '877 C Light', desc: 'Light Silver', category: 'metallic' },
            '#915520': { name: '876 C', desc: 'Copper', category: 'metallic' },
            '#be8a5f': { name: '729 C', desc: 'Light Copper', category: 'metallic' },
            '#54585a': { name: '8003 C', desc: 'Gunmetal', category: 'metallic' },
            '#d5d2d1': { name: '8001 C', desc: 'Platinum', category: 'metallic' },
            '#c0b8b0': { name: '8002 C', desc: 'Warm Silver', category: 'metallic' },
            '#b4975a': { name: '7502 C', desc: 'Old Gold', category: 'metallic' },
            
            // Blues & Teals - Comprehensive (50+ shades with focus on teal/cyan range)
            '#81d8d0': { name: '1837 C', desc: 'Tiffany Blue', category: 'blue' },
            '#80cbc4': { name: '317 C', desc: 'Teal Light', category: 'blue' },
            '#7bc8c4': { name: '318 C', desc: 'Teal Medium', category: 'blue' },
            '#5fb8b3': { name: '3255 C', desc: 'Teal Blue', category: 'blue' },
            '#4bb7b8': { name: '7710 C', desc: 'Teal Bright', category: 'blue' },
            '#4b7d78': { name: '5487 C', desc: 'Teal Dark', category: 'blue' },
            '#447262': { name: '5545 C', desc: 'Teal Forest', category: 'blue' },
            '#3d6663': { name: '5545 C', desc: 'Teal Deep', category: 'blue' },
            '#365b58': { name: '5477 C', desc: 'Teal Very Dark', category: 'blue' },
            '#30504d': { name: '3305 C', desc: 'Deep Teal', category: 'blue' },
            '#294142': { name: '5467 C', desc: 'Dark Teal', category: 'blue' },
            '#223937': { name: '5535 C', desc: 'Very Dark Teal', category: 'blue' },
            '#0abab5': { name: '3262 C', desc: 'Tiffany Teal', category: 'blue' },
            '#00ced1': { name: '3115 C', desc: 'Dark Turquoise', category: 'blue' },
            '#40e0d0': { name: '3252 C', desc: 'Turquoise', category: 'blue' },
            '#70b7ba': { name: '325 C', desc: 'Teal', category: 'blue' },
            '#518883': { name: '5493 C', desc: 'Slate Gray', category: 'blue' },
            '#0077c8': { name: '307 C', desc: 'Process Blue', category: 'blue' },
            '#003087': { name: '294 C', desc: 'Royal Blue', category: 'blue' },
            '#253250': { name: '533 C', desc: 'PGA Blue', category: 'blue' },
            '#00313c': { name: '3308 C', desc: 'Deep Forest', category: 'blue' },
            '#002855': { name: '289 C', desc: 'Navy Blue', category: 'blue' },
            '#00205b': { name: '295 C', desc: 'Dark Navy', category: 'blue' },
            '#4169e1': { name: '2726 C', desc: 'Royal Blue Bright', category: 'blue' },
            '#1e90ff': { name: '2171 C', desc: 'Dodger Blue', category: 'blue' },
            '#00bfff': { name: '298 C', desc: 'Deep Sky Blue', category: 'blue' },
            '#87ceeb': { name: '292 C', desc: 'Sky Blue', category: 'blue' },
            '#b0e0e6': { name: '635 C', desc: 'Powder Blue', category: 'blue' },
            '#add8e6': { name: '2905 C', desc: 'Light Blue', category: 'blue' },
            '#5f9ea0': { name: '5483 C', desc: 'Cadet Blue', category: 'blue' },
            '#008b8b': { name: '321 C', desc: 'Dark Cyan', category: 'blue' },
            '#20b2aa': { name: '3268 C', desc: 'Light Sea Green', category: 'blue' },
            '#48d1cc': { name: '319 C', desc: 'Medium Turquoise', category: 'blue' },
            '#00bcd4': { name: '2200 C', desc: 'Cyan', category: 'blue' },
            '#0099cc': { name: '306 C', desc: 'Process Cyan', category: 'blue' },
            '#006699': { name: '3015 C', desc: 'Deep Cerulean', category: 'blue' },
            '#003366': { name: '302 C', desc: 'Dark Blue', category: 'blue' },
            '#191970': { name: '2767 C', desc: 'Midnight Blue', category: 'blue' },
            '#000080': { name: 'Navy C', desc: 'Navy', category: 'blue' },
            '#0000cd': { name: '2728 C', desc: 'Medium Blue', category: 'blue' },
            '#0000ff': { name: 'Blue C', desc: 'Blue', category: 'blue' },
            '#4682b4': { name: '646 C', desc: 'Steel Blue', category: 'blue' },
            '#6495ed': { name: '659 C', desc: 'Cornflower Blue', category: 'blue' },
            '#afeeee': { name: '317 C', desc: 'Pale Turquoise', category: 'blue' },
            '#e0ffff': { name: '9480 C', desc: 'Light Cyan', category: 'blue' },
            
            // Neons - Extended
            '#24d1e0': { name: '801 C', desc: 'Neon Blue', category: 'neon' },
            '#44d62c': { name: '802 C', desc: 'Neon Green', category: 'neon' },
            '#e0e542': { name: '803 C', desc: 'Neon Yellow', category: 'neon' },
            '#ffaa4d': { name: '804 C', desc: 'Neon Orange', category: 'neon' },
            '#ff3eb5': { name: '806 C', desc: 'Neon Pink', category: 'neon' },
            '#ff6ec7': { name: '807 C', desc: 'Hot Pink', category: 'neon' },
            '#39ff14': { name: '802 C Alt', desc: 'Electric Green', category: 'neon' },
            
            // Greens - Comprehensive (30+ shades)
            '#006747': { name: '3425 C', desc: 'Masters Green', category: 'green' },
            '#009639': { name: '355 C', desc: 'Kelly Green', category: 'green' },
            '#237f52': { name: '341 C', desc: 'Shamrock', category: 'green' },
            '#004d2c': { name: '3435 C', desc: 'Forest Green', category: 'green' },
            '#00563f': { name: '343 C', desc: 'Tropical Green', category: 'green' },
            '#007a3d': { name: '356 C', desc: 'Green', category: 'green' },
            '#00a651': { name: '348 C', desc: 'Emerald', category: 'green' },
            '#00af66': { name: '2252 C', desc: 'Mint Green', category: 'green' },
            '#2e8b57': { name: '3415 C', desc: 'Sea Green', category: 'green' },
            '#3cb371': { name: '346 C', desc: 'Medium Sea Green', category: 'green' },
            '#90ee90': { name: '358 C', desc: 'Light Green', category: 'green' },
            '#98fb98': { name: '2267 C', desc: 'Pale Green', category: 'green' },
            '#8fbc8f': { name: '557 C', desc: 'Dark Sea Green', category: 'green' },
            '#556b2f': { name: '574 C', desc: 'Dark Olive Green', category: 'green' },
            '#6b8e23': { name: '575 C', desc: 'Olive Drab', category: 'green' },
            '#7cfc00': { name: '375 C', desc: 'Lawn Green', category: 'green' },
            '#7fff00': { name: '2270 C', desc: 'Chartreuse', category: 'green' },
            '#adff2f': { name: '374 C', desc: 'Green Yellow', category: 'green' },
            '#9acd32': { name: '2297 C', desc: 'Yellow Green', category: 'green' },
            '#32cd32': { name: '2271 C', desc: 'Lime Green', category: 'green' },
            '#00ff00': { name: '2272 C', desc: 'Lime', category: 'green' },
            '#228b22': { name: '2426 C', desc: 'Forest Green Bright', category: 'green' },
            '#008000': { name: '3500 C', desc: 'Green Dark', category: 'green' },
            '#013220': { name: '3500 C', desc: 'Dark Green', category: 'green' },
            '#50c878': { name: '2256 C', desc: 'Emerald Green', category: 'green' },
            '#00fa9a': { name: '3385 C', desc: 'Medium Spring Green', category: 'green' },
            '#00ff7f': { name: '2270 C', desc: 'Spring Green', category: 'green' },
            '#66cdaa': { name: '337 C', desc: 'Medium Aquamarine', category: 'green' },
            '#7fffd4': { name: '3375 C', desc: 'Aquamarine', category: 'green' },
            
            // Reds & Pinks - Comprehensive (30+ shades)
            '#c8102e': { name: '186 C', desc: 'Titleist Red', category: 'red' },
            '#ed174e': { name: '192 C', desc: 'Cardinal', category: 'red' },
            '#9d2235': { name: '201 C', desc: 'Burgundy', category: 'red' },
            '#6a0c2a': { name: '229 C', desc: 'Dark Maroon', category: 'red' },
            '#680c07': { name: '1815 C', desc: 'Deep Red', category: 'red' },
            '#8b1a1a': { name: '7623 C', desc: 'Dark Red', category: 'red' },
            '#5c0f0f': { name: '497 C', desc: 'Maroon', category: 'red' },
            '#8b0000': { name: '1815 C Alt', desc: 'Dark Red', category: 'red' },
            '#b22222': { name: '187 C', desc: 'Firebrick', category: 'red' },
            '#dc143c': { name: '192 C', desc: 'Crimson', category: 'red' },
            '#ff0000': { name: '2347 C', desc: 'Red', category: 'red' },
            '#ff1493': { name: '226 C', desc: 'Deep Pink', category: 'red' },
            '#ff69b4': { name: '211 C', desc: 'Hot Pink', category: 'red' },
            '#ffb6c1': { name: '182 C', desc: 'Light Pink', category: 'red' },
            '#ffc0cb': { name: '176 C', desc: 'Pink', category: 'red' },
            '#c71585': { name: '234 C', desc: 'Medium Violet Red', category: 'red' },
            '#c6007e': { name: '233 C', desc: 'Process Magenta', category: 'red' },
            '#e0115f': { name: '213 C', desc: 'Ruby', category: 'red' },
            '#cd5c5c': { name: '2032 C', desc: 'Indian Red', category: 'red' },
            '#f08080': { name: '177 C', desc: 'Light Coral', category: 'red' },
            '#fa8072': { name: '178 C', desc: 'Salmon', category: 'red' },
            '#ff6347': { name: '2026 C', desc: 'Tomato', category: 'red' },
            '#ff4500': { name: '172 C', desc: 'Orange Red', category: 'red' },
            '#a52a2a': { name: '490 C', desc: 'Brown', category: 'red' },
            '#800000': { name: '504 C', desc: 'Maroon Dark', category: 'red' },
            '#db7093': { name: '7634 C', desc: 'Pale Violet Red', category: 'red' },
            '#ff007f': { name: 'Rose', desc: 'Rose', category: 'red' },
            '#e6007e': { name: 'Rubine Red', desc: 'Rubine Red', category: 'red' },
            
            // Oranges & Corals - Comprehensive (15+ shades)
            '#ff6900': { name: '165 C', desc: 'Orange', category: 'orange' },
            '#ff8c00': { name: '144 C', desc: 'Dark Orange', category: 'orange' },
            '#ffa500': { name: '137 C', desc: 'Orange Bright', category: 'orange' },
            '#ff7f50': { name: '171 C', desc: 'Coral', category: 'orange' },
            '#ff4500': { name: '172 C', desc: 'Orange Red', category: 'orange' },
            '#d2691e': { name: '723 C', desc: 'Chocolate', category: 'orange' },
            '#cd853f': { name: '729 C', desc: 'Peru', category: 'orange' },
            '#daa520': { name: '7550 C', desc: 'Goldenrod', category: 'orange' },
            '#b8860b': { name: '125 C', desc: 'Dark Goldenrod', category: 'orange' },
            '#ff8c69': { name: '164 C', desc: 'Salmon Orange', category: 'orange' },
            '#ffa07a': { name: '163 C', desc: 'Light Salmon', category: 'orange' },
            '#ff9966': { name: '1585 C', desc: 'Atomic Tangerine', category: 'orange' },
            '#ff6633': { name: '166 C', desc: 'Orange Peel', category: 'orange' },
            
            // Yellows - Comprehensive (15+ shades)
            '#ffb81c': { name: '1235 C', desc: 'Yellow', category: 'yellow' },
            '#ffd700': { name: '116 C', desc: 'Golden Yellow', category: 'yellow' },
            '#ffff00': { name: 'Yellow C', desc: 'Yellow Pure', category: 'yellow' },
            '#ffffe0': { name: '600 C', desc: 'Light Yellow', category: 'yellow' },
            '#fffacd': { name: '607 C', desc: 'Lemon Chiffon', category: 'yellow' },
            '#fafad2': { name: '461 C', desc: 'Light Goldenrod', category: 'yellow' },
            '#ffefd5': { name: '7506 C', desc: 'Papaya Whip', category: 'yellow' },
            '#ffe4b5': { name: '7507 C', desc: 'Moccasin', category: 'yellow' },
            '#f0e68c': { name: '460 C', desc: 'Khaki', category: 'yellow' },
            '#eee8aa': { name: '614 C', desc: 'Pale Goldenrod', category: 'yellow' },
            '#bdb76b': { name: '4505 C', desc: 'Dark Khaki', category: 'yellow' },
            '#e6e200': { name: '3945 C', desc: 'Yellow Bright', category: 'yellow' },
            '#ffcc00': { name: '116 C', desc: 'Gold', category: 'yellow' },
            '#ffeb3b': { name: '012 C', desc: 'Yellow Light', category: 'yellow' },
            
            // Purples & Violets - Comprehensive (30+ shades including very dark purples)
            '#17001f': { name: '276 C', desc: 'Very Dark Purple', category: 'purple' },
            '#1a0033': { name: '275 C', desc: 'Deep Indigo', category: 'purple' },
            '#200040': { name: '274 C', desc: 'Dark Violet', category: 'purple' },
            '#2e1a47': { name: '273 C', desc: 'Deep Purple', category: 'purple' },
            '#3c1053': { name: '2627 C', desc: 'Dark Purple Deep', category: 'purple' },
            '#6f2c91': { name: '259 C', desc: 'Purple', category: 'purple' },
            '#4b2c74': { name: '269 C', desc: 'Dark Purple', category: 'purple' },
            '#8b008b': { name: '2603 C', desc: 'Dark Magenta', category: 'purple' },
            '#9370db': { name: '2567 C', desc: 'Medium Purple', category: 'purple' },
            '#9932cc': { name: '2587 C', desc: 'Dark Orchid', category: 'purple' },
            '#ba55d3': { name: '2583 C', desc: 'Medium Orchid', category: 'purple' },
            '#dda0dd': { name: '251 C', desc: 'Plum', category: 'purple' },
            '#ee82ee': { name: '245 C', desc: 'Violet', category: 'purple' },
            '#da70d6': { name: '2352 C', desc: 'Orchid', category: 'purple' },
            '#ff00ff': { name: 'Magenta', desc: 'Magenta Pure', category: 'purple' },
            '#8a2be2': { name: '2665 C', desc: 'Blue Violet', category: 'purple' },
            '#9400d3': { name: '2602 C', desc: 'Dark Violet', category: 'purple' },
            '#4b0082': { name: '2693 C', desc: 'Indigo', category: 'purple' },
            '#663399': { name: '2685 C', desc: 'Rebecca Purple', category: 'purple' },
            '#7b68ee': { name: '2715 C', desc: 'Medium Slate Blue', category: 'purple' },
            '#6a5acd': { name: '2725 C', desc: 'Slate Blue', category: 'purple' },
            '#836fff': { name: '2715 C Alt', desc: 'Slate Blue Light', category: 'purple' },
            '#d8bfd8': { name: '2085 C', desc: 'Thistle', category: 'purple' },
            '#e6e6fa': { name: '2085 C', desc: 'Lavender', category: 'purple' },
            '#800080': { name: '2617 C', desc: 'Purple Dark', category: 'purple' },
            '#6a0dad': { name: '2617 C', desc: 'Purple Web', category: 'purple' },
            '#301934': { name: '5255 C', desc: 'Eggplant', category: 'purple' },
            '#2b0d35': { name: '5255 C', desc: 'Deep Eggplant', category: 'purple' },
            
            // Browns & Tans - Comprehensive (25+ shades including dark olives)
            '#312705': { name: '448 C', desc: 'Dark Olive Brown', category: 'brown' },
            '#3d3020': { name: '449 C', desc: 'Deep Brown', category: 'brown' },
            '#3e2b1e': { name: '4625 C', desc: 'Very Dark Brown', category: 'brown' },
            '#2e2014': { name: 'Black 6 C', desc: 'Espresso', category: 'brown' },
            '#3f301d': { name: '476 C', desc: 'Coffee Bean', category: 'brown' },
            '#4a3c2a': { name: '4625 C', desc: 'Dark Chocolate', category: 'brown' },
            '#8b4513': { name: '1545 C', desc: 'Saddle Brown', category: 'brown' },
            '#a0522d': { name: '7525 C', desc: 'Sienna', category: 'brown' },
            '#cd853f': { name: '729 C', desc: 'Peru', category: 'brown' },
            '#deb887': { name: '728 C', desc: 'Burlywood', category: 'brown' },
            '#d2b48c': { name: '4665 C', desc: 'Tan', category: 'brown' },
            '#bc8f8f': { name: '4715 C', desc: 'Rosy Brown', category: 'brown' },
            '#f4a460': { name: '722 C', desc: 'Sandy Brown', category: 'brown' },
            '#8b7355': { name: '4625 C', desc: 'Burlywood Dark', category: 'brown' },
            '#6b4423': { name: '1545 C', desc: 'Dark Brown', category: 'brown' },
            '#a0826d': { name: '4715 C', desc: 'Beaver', category: 'brown' },
            '#966919': { name: '1405 C', desc: 'Raw Umber', category: 'brown' },
            '#5d4e37': { name: '497 C', desc: 'Umber', category: 'brown' },
            '#4b3621': { name: '4625 C', desc: 'Dark Earth', category: 'brown' },
            '#654321': { name: '462 C', desc: 'Dark Brown', category: 'brown' },
            '#3b2f2f': { name: 'Black 6 C', desc: 'Seal Brown', category: 'brown' },
            
            // Grays & Neutrals - Comprehensive (25+ shades)
            '#ffffff': { name: 'White', desc: 'Pure White', category: 'neutral' },
            '#f8f8f8': { name: 'Cool Gray 1 C', desc: 'Off White', category: 'neutral' },
            '#f0f0f0': { name: 'Cool Gray 1 C', desc: 'Light Gray', category: 'neutral' },
            '#e8e8e8': { name: 'Cool Gray 2 C', desc: 'Light Gray 2', category: 'neutral' },
            '#d1d3d4': { name: 'Cool Gray 3 C', desc: 'Light Gray 3', category: 'neutral' },
            '#c8c9c7': { name: 'Cool Gray 4 C', desc: 'Light Gray 4', category: 'neutral' },
            '#b1b3b3': { name: 'Cool Gray 5 C', desc: 'Medium Gray', category: 'neutral' },
            '#a7a9ac': { name: 'Cool Gray 5 C', desc: 'Medium Gray', category: 'neutral' },
            '#97999b': { name: 'Cool Gray 6 C', desc: 'Medium Gray 2', category: 'neutral' },
            '#888b8d': { name: 'Cool Gray 7 C', desc: 'Medium Gray 3', category: 'neutral' },
            '#75787b': { name: 'Cool Gray 8 C', desc: 'Dark Gray', category: 'neutral' },
            '#63666a': { name: 'Cool Gray 9 C', desc: 'Dark Gray 2', category: 'neutral' },
            '#53565a': { name: 'Cool Gray 10 C', desc: 'Dark Gray 3', category: 'neutral' },
            '#53565a': { name: 'Cool Gray 11 C', desc: 'Dark Gray 4', category: 'neutral' },
            '#434447': { name: 'Black 2 C', desc: 'Charcoal', category: 'neutral' },
            '#3e3e3f': { name: 'Black 3 C', desc: 'Dark Charcoal', category: 'neutral' },
            '#353536': { name: 'Black 4 C', desc: 'Darker Charcoal', category: 'neutral' },
            '#2f2f30': { name: 'Black 5 C', desc: 'Almost Black', category: 'neutral' },
            '#2d2926': { name: 'Black 6 C', desc: 'Rich Black', category: 'neutral' },
            '#1c1c1c': { name: 'Black 7 C', desc: 'Deep Black', category: 'neutral' },
            '#000000': { name: 'Black C', desc: 'Pure Black', category: 'neutral' },
            '#c0c0c0': { name: 'Silver', desc: 'Silver Gray', category: 'neutral' },
            '#808080': { name: 'Gray', desc: 'Gray', category: 'neutral' },
            '#696969': { name: 'Dim Gray', desc: 'Dim Gray', category: 'neutral' },
            '#dcdcdc': { name: 'Gainsboro', desc: 'Gainsboro', category: 'neutral' },
            '#d3d3d3': { name: 'Light Gray', desc: 'Light Gray Web', category: 'neutral' }
        };

        function unlock() {
            if(document.getElementById('pw').value.toLowerCase() === 'golf') {
                document.getElementById('lock-screen').style.display = 'none';
                document.getElementById('app').style.display = 'grid';
                initDesigner();
                showNotification('âœ“ Access Granted');
            } else {
                showNotification('âœ— Invalid Password', '#e74c3c');
            }
        }

        function showNotification(msg, color = '#27ae60') {
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.textContent = msg;
            notif.style.background = color;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 3000);
        }

        function copyHex(hex) {
            navigator.clipboard.writeText(hex);
            showNotification(`âœ“ Copied ${hex}`);
        }

        function getSKU() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let res = '';
            for (let i = 0; i < 4; i++) res += chars.charAt(Math.floor(Math.random() * chars.length));
            return res;
        }

        // Helper function to determine color category from RGB
        function getColorCategory(r, g, b) {
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            const diff = max - min;
            
            // Very low saturation = neutral
            if(diff < 15) return 'neutral';
            
            // Determine dominant hue
            if(r > g && r > b) {
                if(g > b * 1.5) return 'orange'; // Orange-ish
                return 'red';
            } else if(g > r && g > b) {
                if(b > r * 1.3) return 'blue'; // Cyan/teal
                return 'green';
            } else if(b > r && b > g) {
                if(r > g * 1.2) return 'purple';
                return 'blue';
            }
            return 'neutral';
        }

        // Improved Pantone matching with hue-aware algorithm
        function findPantone(hex) {
            // Normalize input hex
            hex = hex.toLowerCase().trim();
            if(!hex.startsWith('#')) hex = '#' + hex;
            
            // Exact match
            for(let key in PANTONE_DB) {
                if(key.toLowerCase() === hex) {
                    return {
                        text: `${PANTONE_DB[key].name} (${PANTONE_DB[key].desc})`,
                        quality: 'exact',
                        distance: 0
                    };
                }
            }
            
            const r1 = parseInt(hex.substring(1,3), 16);
            const g1 = parseInt(hex.substring(3,5), 16);
            const b1 = parseInt(hex.substring(5,7), 16);
            const inputCategory = getColorCategory(r1, g1, b1);
            
            // Find closest match, prioritizing same color family
            let bestMatch = null;
            let minDistance = Infinity;
            
            for(let key in PANTONE_DB) {
                const normalizedKey = key.toLowerCase();
                const r2 = parseInt(normalizedKey.substring(1,3), 16);
                const g2 = parseInt(normalizedKey.substring(3,5), 16);
                const b2 = parseInt(normalizedKey.substring(5,7), 16);
                
                // Calculate standard color distance
                const colorDistance = Math.sqrt(
                    Math.pow(r1-r2, 2) + 
                    Math.pow(g1-g2, 2) + 
                    Math.pow(b1-b2, 2)
                );
                
                // Apply penalty if categories don't match (except for neutrals)
                let distance = colorDistance;
                const pantoneCategory = PANTONE_DB[key].category;
                
                if(inputCategory !== 'neutral' && pantoneCategory !== inputCategory && pantoneCategory !== 'neutral' && pantoneCategory !== 'metallic') {
                    distance *= 1.8; // Penalize different color families
                }
                
                if(distance < minDistance) {
                    minDistance = distance;
                    bestMatch = PANTONE_DB[key];
                }
            }
            
            // Classify match quality
            let quality = 'approx';
            if(minDistance < 30) quality = 'exact';
            else if(minDistance < 80) quality = 'close';
            
            return {
                text: `${bestMatch.name} (${bestMatch.desc})${quality === 'approx' ? ' ~' : ''}`,
                quality: quality,
                distance: minDistance
            };
        }

        function refreshPreview() {
            if(!currentID) currentID = getSKU();
            const L = document.getElementById('len').value;
            const T = parseFloat(document.getElementById('topD').value);
            const B = parseFloat(document.getElementById('botD').value);
            
            document.getElementById('skuDisplay').innerText = `F-${L}-${currentID}`;
            
            const viz = document.getElementById('preview');
            const max = Math.max(T, B);
            const topP = ((T / max) * 100) / 2;
            const botP = ((B / max) * 100) / 2;
            
            viz.style.clipPath = `polygon(${50-topP}% 0%, ${50+topP}% 0%, ${50+botP}% 100%, ${50-botP}% 100%)`;
            viz.innerHTML = '';
            
            activeColors.forEach((c, idx) => {
                const s = document.createElement('div');
                s.className = 'sec-slice';
                if(selectedSection === idx) s.classList.add('selected');
                s.style.background = c;
                s.onclick = () => selectSection(idx);
                viz.appendChild(s);
            });
        }

        function selectSection(index) {
            selectedSection = index;
            document.querySelectorAll('.section-row').forEach((row, i) => {
                row.classList.toggle('selected', i === index);
            });
            refreshPreview();
        }

        function updateSection(index, hex) {
            if(!hex.startsWith('#')) hex = '#' + hex;
            if(/^#[0-9A-F]{6}$/i.test(hex)) {
                activeColors[index] = hex;
                document.getElementById(`p${index}`).value = hex;
                document.getElementById(`h${index}`).value = hex.toUpperCase();
                
                const match = findPantone(hex);
                const tag = document.getElementById(`tag${index}`);
                tag.innerText = match.text;
                tag.className = `pantone-tag ${match.quality}`;
                
                currentID = getSKU();
                refreshPreview();
            }
        }

        function applyPattern(type) {
            if(selectedSection === null) {
                showNotification('âš  Select a section first', '#f39c12');
                return;
            }
            
            const baseColor = activeColors[selectedSection];
            
            if(type === 'gradient') {
                // Apply gradient from selected color to black
                for(let i = 0; i < TOTAL_SECS; i++) {
                    const ratio = i / (TOTAL_SECS - 1);
                    const r = Math.round(parseInt(baseColor.substring(1,3), 16) * (1 - ratio));
                    const g = Math.round(parseInt(baseColor.substring(3,5), 16) * (1 - ratio));
                    const b = Math.round(parseInt(baseColor.substring(5,7), 16) * (1 - ratio));
                    updateSection(i, `#${r.toString(16).padStart(2,'0')}${g.toString(16).padStart(2,'0')}${b.toString(16).padStart(2,'0')}`);
                }
            } else if(type === 'alternate') {
                const color2 = activeColors[(selectedSection + 1) % TOTAL_SECS];
                for(let i = 0; i < TOTAL_SECS; i++) {
                    updateSection(i, i % 2 === 0 ? baseColor : color2);
                }
            } else if(type === 'triple') {
                const color2 = activeColors[(selectedSection + 5) % TOTAL_SECS];
                const color3 = activeColors[(selectedSection + 10) % TOTAL_SECS];
                for(let i = 0; i < TOTAL_SECS; i++) {
                    const colorIndex = i % 3;
                    updateSection(i, colorIndex === 0 ? baseColor : colorIndex === 1 ? color2 : color3);
                }
            }
            
            showNotification(`âœ“ ${type} pattern applied`);
        }

        function copyAllColors() {
            const hexList = activeColors.map((c, i) => `S${i+1}: ${c}`).join('\n');
            navigator.clipboard.writeText(hexList);
            showNotification('âœ“ All hex codes copied');
        }

        function initDesigner() {
            const ctrl = document.getElementById('sectionControls');
            ctrl.innerHTML = '';
            for(let i=0; i<TOTAL_SECS; i++) {
                const row = document.createElement('div');
                row.className = 'section-row';
                row.innerHTML = `
                    <label style="font-size:0.55rem; width:15px; color:#777; font-weight:bold;">${i+1}</label>
                    <input type="color" id="p${i}" value="${activeColors[i]}">
                    <input type="text" id="h${i}" value="${activeColors[i].toUpperCase()}" maxlength="7" placeholder="#000000">
                    <span class="pantone-tag" id="tag${i}"></span>
                `;
                ctrl.appendChild(row);

                const picker = row.querySelector(`#p${i}`);
                const hexIn = row.querySelector(`#h${i}`);

                picker.addEventListener('input', (e) => updateSection(i, e.target.value));
                hexIn.addEventListener('input', (e) => updateSection(i, e.target.value));
                
                row.addEventListener('click', (e) => {
                    if(e.target.tagName !== 'INPUT') selectSection(i);
                });
                
                // Initialize Pantone display
                const match = findPantone(activeColors[i]);
                const tag = document.getElementById(`tag${i}`);
                tag.innerText = match.text;
                tag.className = `pantone-tag ${match.quality}`;
            }
            
            // Add click handlers to metallic swatches
            document.querySelectorAll('.m-swatch').forEach(swatch => {
                swatch.addEventListener('click', () => {
                    const hex = swatch.getAttribute('data-hex');
                    if(selectedSection !== null) {
                        updateSection(selectedSection, hex);
                        showNotification(`âœ“ Applied to Section ${selectedSection + 1}`);
                    } else {
                        copyHex(hex);
                    }
                });
            });
            
            refreshPreview();
        }

        function downloadSpec() {
            const sku = document.getElementById('skuDisplay').innerText;
            const L = document.getElementById('len').value;
            const T = document.getElementById('topD').value;
            const B = document.getElementById('botD').value;
            const ID = document.getElementById('wall').value;

            let out = `FERRULE PRODUCTION SPECIFICATION\n================================\n`;
            out += `Generated: ${new Date().toLocaleString()}\n`;
            out += `SKU: ${sku}\n\n`;
            out += `GEOMETRY:\n`;
            out += `Length: ${L}mm\n`;
            out += `Top Ã˜: ${T}mm\n`;
            out += `Bottom Ã˜: ${B}mm\n`;
            out += `Internal Ã˜: ${ID}mm\n\n`;
            out += `COLOR SEQUENCE (Top to Bottom):\n`;
            out += `${'='.repeat(50)}\n`;
            
            activeColors.forEach((c, i) => {
                const match = findPantone(c);
                out += `Section ${String(i+1).padStart(2, '0')}: ${match.text.padEnd(30)} | ${c.toUpperCase()} | Quality: ${match.quality.toUpperCase()}\n`;
            });
            
            out += `\n${'='.repeat(50)}\n`;
            out += `NOTES:\n`;
            out += `- Match quality: EXACT (perfect), CLOSE (within tolerance), APPROX (approximate)\n`;
            out += `- Verify color samples before production\n`;
            out += `- Contact color@ferrule.com for custom Pantone matching\n`;
            
            const b = new Blob([out], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(b);
            a.download = `Ferrule-Spec-${sku}.txt`;
            a.click();
            
            showNotification('âœ“ Specification downloaded');
        }

        function resetDesigner() {
            if(confirm('Reset all colors and settings?')) {
                activeColors = Array(TOTAL_SECS).fill('#000000');
                selectedSection = null;
                currentID = getSKU();
                document.querySelectorAll('.section-row').forEach((row, i) => {
                    updateSection(i, '#000000');
                });
                refreshPreview();
                showNotification('âœ“ Designer reset');
            }
        }

        // Event listeners for geometry inputs
        ['len', 'topD', 'botD', 'wall'].forEach(id => {
            document.getElementById(id).addEventListener('input', () => { 
                currentID = getSKU(); 
                refreshPreview(); 
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if(e.key === 'ArrowUp' && selectedSection !== null && selectedSection > 0) {
                e.preventDefault();
                selectSection(selectedSection - 1);
            } else if(e.key === 'ArrowDown' && selectedSection !== null && selectedSection < TOTAL_SECS - 1) {
                e.preventDefault();
                selectSection(selectedSection + 1);
            }
        });

        document.getElementById('pw').addEventListener('keypress', (e) => { 
            if(e.key === 'Enter') unlock(); 
        });
    </script>
</body>
</html>
