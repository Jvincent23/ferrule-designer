<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf Club Ferrule Designer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 40px;
        }
        
        .design-panel {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .canvas-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }
        
        .ferrule-display {
            position: relative;
            width: 100%;
            max-width: 400px;
        }
        
        .ferrule {
            width: 100%;
            height: 500px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .ferrule-3d {
            width: 300px;
            height: 450px;
            position: relative;
        }
        
        .ferrule-body {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            clip-path: polygon(
                29% 0%,
                71% 0%,
                100% 100%,
                0% 100%
            );
            background: white;
        }
        
        .ferrule-section {
            height: 5%;
            border-bottom: 1px solid rgba(0,0,0,0.15);
            position: relative;
            transition: background-color 0.3s ease;
        }
        
        .ferrule-section:last-child {
            border-bottom: none;
        }
        
        .section-label {
            position: absolute;
            right: -70px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 11px;
            font-weight: bold;
            white-space: nowrap;
            z-index: 20;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        #colorControlsContainer {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        #colorControlsContainer::-webkit-scrollbar {
            width: 8px;
        }
        
        #colorControlsContainer::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        #colorControlsContainer::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }
        
        #colorControlsContainer::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }
        
        .control-group h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .color-control {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .color-control label {
            display: block;
            font-weight: 600;
            color: #34495e;
            margin-bottom: 10px;
        }
        
        .color-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        input[type="color"] {
            width: 60px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        input[type="text"] {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            cursor: text;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .pantone-info {
            background: #fff3cd;
            padding: 10px;
            border-radius: 8px;
            margin-top: 8px;
            font-size: 13px;
            color: #856404;
        }
        
        .preset-colors {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .preset-color {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
            position: relative;
        }
        
        .preset-color:hover {
            transform: scale(1.1);
            border-color: #2c3e50;
        }
        
        .preset-color::after {
            content: attr(data-name);
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }
        
        .preset-color:hover::after {
            opacity: 1;
        }
        
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #e0e0e0;
            color: #2c3e50;
        }
        
        .btn-secondary:hover {
            background: #d0d0d0;
        }
        
        .dimensions {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .dimensions h4 {
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        .dimension-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .dimension-input label {
            flex: 1;
            font-weight: 600;
        }
        
        .dimension-input input {
            width: 80px;
            padding: 8px;
            border: 2px solid #a5d6a7;
            border-radius: 5px;
        }
        
        .specs-display {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .specs-display h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .spec-item:last-child {
            border-bottom: none;
        }
        
        .spec-label {
            font-weight: 600;
            color: #555;
        }
        
        .spec-value {
            font-family: monospace;
            color: #667eea;
        }
        
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Styling for the new SKU and Name fields */
        .highlight-spec {
            background: #f0f4ff;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 5px solid #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚õ≥ Golf Club Ferrule Designer</h1>
            <p>Design custom ferrules with precise color control and Pantone matching</p>
        </div>
        
        <div class="main-content">
            <div class="design-panel">
                <div class="control-group">
                    <h3>üé® Color Sections (1.25mm each)</h3>
                    <div id="colorControlsContainer"></div>
                </div>
                
                <div class="control-group">
                    <h3>üéØ Preset Color Palettes</h3>
                    <div class="preset-colors" id="presetColors"></div>
                </div>
                
                <div class="dimensions">
                    <h4>üìè Ferrule Specifications</h4>
                    <div class="dimension-input">
                        <label>Length (mm):</label>
                        <input type="number" id="length" value="25" min="15" max="40">
                    </div>
                    <div class="dimension-input">
                        <label>Top Diameter (mm):</label>
                        <input type="number" id="topDiameter" value="10.5" min="8" max="14" step="0.5">
                    </div>
                    <div class="dimension-input">
                        <label>Bottom Diameter (mm):</label>
                        <input type="number" id="bottomDiameter" value="14.5" min="10" max="18" step="0.5">
                    </div>
                    <div class="dimension-input">
                        <label>Wall Thickness (mm):</label>
                        <input type="number" id="thickness" value="1.5" min="0.5" max="3" step="0.1">
                    </div>
                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #a5d6a7;">
                        <small><strong>Taper:</strong> <span id="taperAngle">0.00¬∞</span> | <strong>Ratio:</strong> <span id="taperRatio">1.38:1</span></small>
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn-secondary" onclick="resetDesign()">Reset</button>
                    <button class="btn-primary" onclick="exportImage()">Export PNG</button>
                    <button class="btn-primary" onclick="saveDesign()">Save Specs</button>
                </div>
            </div>
            
            <div class="canvas-container">
                <div class="ferrule-display">
                    <div class="ferrule">
                        <div class="ferrule-3d">
                            <div class="ferrule-body" id="ferruleBody">
                                </div>
                        </div>
                    </div>
                </div>
                
                <div class="specs-display">
                    <h3>Design Specifications</h3>
                    
                    <div class="spec-item highlight-spec">
                        <span class="spec-label">SKU Code:</span>
                        <span class="spec-value" id="spec-sku" style="font-size: 1.2em; font-weight: bold; color: #2c3e50;">F-25-2</span>
                    </div>
                    <div class="spec-item highlight-spec" style="border-left-color: #764ba2; margin-bottom: 20px;">
                        <span class="spec-label">Design Name:</span>
                        <span class="spec-value" id="spec-name" style="font-size: 1.1em; font-weight: bold; color: #2c3e50;">Classic</span>
                    </div>
                    
                    <div id="specsContainer"></div>
                    <div class="spec-item">
                        <span class="spec-label">Length:</span>
                        <span class="spec-value" id="spec-length">25 mm</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">Top Diameter:</span>
                        <span class="spec-value" id="spec-topDiameter">10.5 mm</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">Bottom Diameter:</span>
                        <span class="spec-value" id="spec-bottomDiameter">14.5 mm</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">Wall Thickness:</span>
                        <span class="spec-value" id="spec-thickness">1.5 mm</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">Taper Angle:</span>
                        <span class="spec-value" id="spec-taperAngle">9.09¬∞</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const NUM_SECTIONS = 20;
        const SECTION_HEIGHT = 1.25;
        let sectionColors = [];
        let lastPresetName = "Custom Design"; // Track the current design name
        
        // Pantone color database
        const pantoneColors = {
            '#000000': 'Black C',
            '#ffffff': 'White',
            '#ff0000': 'Red 032 C',
            '#0000ff': 'Blue 072 C',
            '#00ff00': 'Green C',
            '#ffff00': 'Yellow C',
            '#ff6600': 'Orange 021 C',
            '#800080': 'Purple C',
            '#ffc0cb': 'Pink C',
            '#808080': 'Cool Gray 9 C',
            '#c0c0c0': 'Cool Gray 4 C',
            '#8b0000': 'Red 187 C',
            '#00008b': 'Blue 286 C',
            '#006400': 'Green 3415 C',
            '#ffd700': 'Yellow 012 C',
            '#4169e1': 'Blue 2935 C',
            '#32cd32': 'Green 375 C',
            '#ff1493': 'Pink 225 C',
            '#1e90ff': 'Blue 2727 C',
            '#ff4500': 'Orange 165 C',
            '#2f4f4f': 'Black 6 C',
            '#708090': 'Cool Gray 10 C',
            '#b22222': 'Red 186 C',
            '#191970': 'Navy Blue 533 C',
            '#556b2f': 'Green 5747 C'
        };

        // Preset color schemes (20 sections)
        const presetSchemes = [
            { 
                name: 'Classic', 
                colors: ['#000000', '#000000', '#ffffff', '#ffffff', '#ff0000', '#ff0000', '#ffffff', '#ffffff', '#000000', '#000000', '#000000', '#000000', '#ffffff', '#ffffff', '#ff0000', '#ff0000', '#ffffff', '#ffffff', '#000000', '#000000'] 
            },
            { 
                name: 'Royal', 
                colors: ['#0000ff', '#0000ff', '#ffd700', '#ffd700', '#ffffff', '#ffffff', '#ffd700', '#ffd700', '#0000ff', '#0000ff', '#0000ff', '#0000ff', '#ffd700', '#ffd700', '#ffffff', '#ffffff', '#ffd700', '#ffd700', '#0000ff', '#0000ff'] 
            },
            { 
                name: 'Forest', 
                colors: ['#006400', '#006400', '#8b4513', '#8b4513', '#ffffff', '#ffffff', '#8b4513', '#8b4513', '#006400', '#006400', '#006400', '#006400', '#8b4513', '#8b4513', '#ffffff', '#ffffff', '#8b4513', '#8b4513', '#006400', '#006400'] 
            },
            { 
                name: 'Fire', 
                colors: ['#ff0000', '#ff0000', '#ff6600', '#ff6600', '#ffff00', '#ffff00', '#ff6600', '#ff6600', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff6600', '#ff6600', '#ffff00', '#ffff00', '#ff6600', '#ff6600', '#ff0000', '#ff0000'] 
            },
            { 
                name: 'Ocean', 
                colors: ['#000080', '#000080', '#1e90ff', '#1e90ff', '#00ffff', '#00ffff', '#1e90ff', '#1e90ff', '#000080', '#000080', '#000080', '#000080', '#1e90ff', '#1e90ff', '#00ffff', '#00ffff', '#1e90ff', '#1e90ff', '#000080', '#000080'] 
            },
            { 
                name: 'Sunset', 
                colors: ['#ff4500', '#ff4500', '#ffd700', '#ffd700', '#ff1493', '#ff1493', '#ffd700', '#ffd700', '#ff4500', '#ff4500', '#ff4500', '#ff4500', '#ffd700', '#ffd700', '#ff1493', '#ff1493', '#ffd700', '#ffd700', '#ff4500', '#ff4500'] 
            },
            { 
                name: 'Stealth', 
                colors: ['#000000', '#000000', '#808080', '#808080', '#c0c0c0', '#c0c0c0', '#808080', '#808080', '#000000', '#000000', '#000000', '#000000', '#808080', '#808080', '#c0c0c0', '#c0c0c0', '#808080', '#808080', '#000000', '#000000'] 
            },
            { 
                name: 'Neon', 
                colors: ['#00ff00', '#00ff00', '#ff00ff', '#ff00ff', '#00ffff', '#00ffff', '#ff00ff', '#ff00ff', '#00ff00', '#00ff00', '#00ff00', '#00ff00', '#ff00ff', '#ff00ff', '#00ffff', '#00ffff', '#ff00ff', '#ff00ff', '#00ff00', '#00ff00'] 
            },
            {
                name: 'USA',
                colors: ['#ff0000', '#ff0000', '#ffffff', '#ffffff', '#0000ff', '#0000ff', '#ff0000', '#ff0000', '#ffffff', '#ffffff', '#0000ff', '#0000ff', '#ff0000', '#ff0000', '#ffffff', '#ffffff', '#0000ff', '#0000ff', '#ff0000', '#ff0000']
            },
            {
                name: 'Tiger',
                colors: ['#ff6600', '#000000', '#ff6600', '#000000', '#ff6600', '#000000', '#ff6600', '#000000', '#ff6600', '#000000', '#ff6600', '#000000', '#ff6600', '#000000', '#ff6600', '#000000', '#ff6600', '#000000', '#ff6600', '#000000']
            },
            {
                name: 'Stripe',
                colors: ['#000000', '#000000', '#000000', '#ffffff', '#ffffff', '#000000', '#000000', '#ffffff', '#ffffff', '#000000', '#000000', '#000000', '#ffffff', '#ffffff', '#000000', '#000000', '#ffffff', '#ffffff', '#000000', '#000000']
            },
            {
                name: 'Cyan',
                colors: ['#000000', '#000000', '#000000', '#00CED1', '#ffffff', '#000000', '#00CED1', '#ffffff', '#000000', '#000000', '#000000', '#000000', '#00CED1', '#ffffff', '#000000', '#00CED1', '#ffffff', '#000000', '#000000', '#000000']
            },
            {
                name: 'Silver',
                colors: ['#000000', '#000000', '#000000', '#C0C0C0', '#ffffff', '#000000', '#C0C0C0', '#ffffff', '#000000', '#000000', '#000000', '#000000', '#C0C0C0', '#ffffff', '#000000', '#C0C0C0', '#ffffff', '#000000', '#000000', '#000000']
            },
            {
                name: 'Graphite',
                colors: ['#000000', '#000000', '#000000', '#808080', '#ffffff', '#000000', '#808080', '#ffffff', '#000000', '#000000', '#000000', '#000000', '#808080', '#ffffff', '#000000', '#808080', '#ffffff', '#000000', '#000000', '#000000']
            },
            {
                name: 'Premium',
                colors: ['#000000', '#000000', '#000000', '#DAA520', '#00CED1', '#ffffff', '#00CED1', '#DAA520', '#000000', '#000000', '#000000', '#000000', '#DAA520', '#00CED1', '#ffffff', '#00CED1', '#DAA520', '#000000', '#000000', '#000000']
            },
            {
                name: 'Lime',
                colors: ['#000000', '#000000', '#000000', '#32CD32', '#ffffff', '#000000', '#32CD32', '#ffffff', '#000000', '#000000', '#000000', '#000000', '#32CD32', '#ffffff', '#000000', '#32CD32', '#ffffff', '#000000', '#000000', '#000000']
            },
            {
                name: 'Gold',
                colors: ['#000000', '#000000', '#000000', '#DAA520', '#DAA520', '#ffffff', '#ffffff', '#DAA520', '#DAA520', '#000000', '#000000', '#000000', '#DAA520', '#DAA520', '#ffffff', '#ffffff', '#DAA520', '#DAA520', '#000000', '#000000']
            }
        ];

        // NEW: Function to update SKU and Name
        function updateSKUAndName(presetName = null) {
            if (presetName) lastPresetName = presetName;
            
            const length = document.getElementById('length').value;
            const uniqueColorsCount = [...new Set(sectionColors)].length;
            
            // Generate Simple SKU: F-Length-UniqueColors
            const sku = `F-${length}-${uniqueColorsCount}`;
            document.getElementById('spec-sku').textContent = sku;
            
            // Set Name
            if (!presetName && lastPresetName === "Custom Design") {
                // If custom, name it after the primary (first) color
                const colorHex = sectionColors[0];
                const colorName = hexToPantone(colorHex).split(' ')[0];
                document.getElementById('spec-name').textContent = `${colorName} Custom`;
            } else {
                document.getElementById('spec-name').textContent = lastPresetName;
            }
        }

        function hexToPantone(hex) {
            hex = hex.toUpperCase();
            if (pantoneColors[hex.toLowerCase()]) {
                return pantoneColors[hex.toLowerCase()];
            }
            
            let closestColor = '#000000';
            let minDistance = Infinity;
            
            const r1 = parseInt(hex.substr(1, 2), 16);
            const g1 = parseInt(hex.substr(3, 2), 16);
            const b1 = parseInt(hex.substr(5, 2), 16);
            
            for (let pantoneHex in pantoneColors) {
                const r2 = parseInt(pantoneHex.substr(1, 2), 16);
                const g2 = parseInt(pantoneHex.substr(3, 2), 16);
                const b2 = parseInt(pantoneHex.substr(5, 2), 16);
                
                const distance = Math.sqrt(
                    Math.pow(r1 - r2, 2) +
                    Math.pow(g1 - g2, 2) +
                    Math.pow(b1 - b2, 2)
                );
                
                if (distance < minDistance) {
                    minDistance = distance;
                    closestColor = pantoneHex;
                }
            }
            
            return pantoneColors[closestColor] + ' (closest match)';
        }

        function initializeSections() {
            sectionColors = [];
            for (let i = 0; i < NUM_SECTIONS; i++) {
                sectionColors.push(i % 2 === 0 ? '#000000' : '#ffffff');
            }
            createColorControls();
            createFerruleSections();
            updateAllColors();
            updateSpecsDisplay();
        }

        function createColorControls() {
            const container = document.getElementById('colorControlsContainer');
            container.innerHTML = '';
            
            for (let i = 0; i < NUM_SECTIONS; i++) {
                const control = document.createElement('div');
                control.className = 'color-control';
                control.innerHTML = `
                    <label>Section ${i + 1} (${(i * SECTION_HEIGHT).toFixed(1)}-${((i + 1) * SECTION_HEIGHT).toFixed(1)}mm)</label>
                    <div class="color-input-group">
                        <input type="color" id="color${i + 1}" value="${sectionColors[i]}">
                        <input type="text" id="hex${i + 1}" value="${sectionColors[i].toUpperCase()}" placeholder="#000000">
                    </div>
                    <div class="pantone-info" id="pantone${i + 1}">Pantone: ${hexToPantone(sectionColors[i])}</div>
                `;
                container.appendChild(control);
                
                const colorInput = control.querySelector(`#color${i + 1}`);
                const hexInput = control.querySelector(`#hex${i + 1}`);
                
                colorInput.addEventListener('input', () => updateColor(i + 1));
                hexInput.addEventListener('input', () => updateColorFromHex(i + 1));
                hexInput.addEventListener('blur', () => validateHex(i + 1));
            }
        }

        function createFerruleSections() {
            const ferruleBody = document.getElementById('ferruleBody');
            ferruleBody.innerHTML = '';
            
            for (let i = 0; i < NUM_SECTIONS; i++) {
                const section = document.createElement('div');
                section.className = 'ferrule-section';
                section.id = `section${i + 1}`;
                section.innerHTML = `<span class="section-label">${i + 1}</span>`;
                section.style.backgroundColor = sectionColors[i];
                ferruleBody.appendChild(section);
            }
        }

        function updateColor(sectionNum) {
            const index = sectionNum - 1;
            const colorPicker = document.getElementById(`color${sectionNum}`);
            const hexInput = document.getElementById(`hex${sectionNum}`);
            const pantoneInfo = document.getElementById(`pantone${sectionNum}`);
            const section = document.getElementById(`section${sectionNum}`);
            
            const color = colorPicker.value;
            sectionColors[index] = color;
            
            hexInput.value = color.toUpperCase();
            section.style.backgroundColor = color;
            pantoneInfo.textContent = `Pantone: ${hexToPantone(color)}`;
            
            lastPresetName = "Custom Design"; // Reset to custom when manual change happens
            updateSpecsDisplay();
            updateSKUAndName();
        }

        function updateColorFromHex(sectionNum) {
            const index = sectionNum - 1;
            const hexInput = document.getElementById(`hex${sectionNum}`);
            let hexValue = hexInput.value.trim();
            
            if (hexValue && !hexValue.startsWith('#')) {
                hexValue = '#' + hexValue;
            }
            
            const hexRegex = /^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/;
            
            if (hexRegex.test(hexValue)) {
                if (hexValue.length === 4) {
                    hexValue = '#' + hexValue[1] + hexValue[1] + hexValue[2] + hexValue[2] + hexValue[3] + hexValue[3];
                }
                
                const colorPicker = document.getElementById(`color${sectionNum}`);
                const pantoneInfo = document.getElementById(`pantone${sectionNum}`);
                const section = document.getElementById(`section${sectionNum}`);
                
                sectionColors[index] = hexValue;
                colorPicker.value = hexValue;
                hexInput.value = hexValue.toUpperCase();
                section.style.backgroundColor = hexValue;
                pantoneInfo.textContent = `Pantone: ${hexToPantone(hexValue)}`;
                
                hexInput.style.borderColor = '#e0e0e0';
                hexInput.style.backgroundColor = '';
                
                lastPresetName = "Custom Design";
                updateSpecsDisplay();
                updateSKUAndName();
            } else if (hexValue.length > 0) {
                hexInput.style.borderColor = '#ff4444';
                hexInput.style.backgroundColor = '#fff0f0';
            }
        }

        function validateHex(sectionNum) {
            const index = sectionNum - 1;
            const hexInput = document.getElementById(`hex${sectionNum}`);
            let hexValue = hexInput.value.trim();
            
            if (hexValue && !hexValue.startsWith('#')) {
                hexValue = '#' + hexValue;
            }
            
            const hexRegex = /^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/;
            
            if (!hexRegex.test(hexValue)) {
                hexInput.value = sectionColors[index].toUpperCase();
                hexInput.style.borderColor = '#e0e0e0';
                hexInput.style.backgroundColor = '';
            }
        }

        function updateAllColors() {
            for (let i = 1; i <= NUM_SECTIONS; i++) {
                // Modified update logic to avoid resetting name during mass update
                const color = sectionColors[i-1];
                document.getElementById(`color${i}`).value = color;
                document.getElementById(`hex${i}`).value = color.toUpperCase();
                document.getElementById(`section${i}`).style.backgroundColor = color;
                document.getElementById(`pantone${i}`).textContent = `Pantone: ${hexToPantone(color)}`;
            }
            updateSpecsDisplay();
        }

        function updateSpecsDisplay() {
            const container = document.getElementById('specsContainer');
            container.innerHTML = '';
            
            for (let i = 0; i < NUM_SECTIONS; i++) {
                const specItem = document.createElement('div');
                specItem.className = 'spec-item';
                specItem.innerHTML = `
                    <span class="spec-label">Section ${i + 1}:</span>
                    <span class="spec-value">${sectionColors[i].toUpperCase()}</span>
                `;
                container.appendChild(specItem);
            }
        }

        function updateDimension() {
            const length = parseFloat(document.getElementById('length').value);
            const topDiameter = parseFloat(document.getElementById('topDiameter').value);
            const bottomDiameter = parseFloat(document.getElementById('bottomDiameter').value);
            const thickness = parseFloat(document.getElementById('thickness').value);
            
            const radiusDiff = (bottomDiameter - topDiameter) / 2;
            const taperAngle = Math.atan(radiusDiff / length) * (180 / Math.PI);
            const taperRatio = (bottomDiameter / topDiameter).toFixed(2);
            
            document.getElementById('spec-length').textContent = `${length} mm`;
            document.getElementById('spec-topDiameter').textContent = `${topDiameter} mm`;
            document.getElementById('spec-bottomDiameter').textContent = `${bottomDiameter} mm`;
            document.getElementById('spec-thickness').textContent = `${thickness} mm`;
            document.getElementById('spec-taperAngle').textContent = `${taperAngle.toFixed(2)}¬∞`;
            
            document.getElementById('taperAngle').textContent = `${taperAngle.toFixed(2)}¬∞`;
            document.getElementById('taperRatio').textContent = `${taperRatio}:1`;

            updateSKUAndName();
        }

        // Updated function to handle preset click correctly
        function loadPresetScheme(scheme) {
            for (let i = 0; i < NUM_SECTIONS && i < scheme.colors.length; i++) {
                sectionColors[i] = scheme.colors[i];
            }
            updateAllColors();
            updateSKUAndName(scheme.name);
        }

        function resetDesign() {
            for (let i = 0; i < NUM_SECTIONS; i++) {
                sectionColors[i] = i % 2 === 0 ? '#000000' : '#ffffff';
            }
            updateAllColors();
            document.getElementById('length').value = 25;
            document.getElementById('topDiameter').value = 10.5;
            document.getElementById('bottomDiameter').value = 14.5;
            document.getElementById('thickness').value = 1.5;
            lastPresetName = "Classic";
            updateDimension();
        }

        function saveDesign() {
            const sku = document.getElementById('spec-sku').textContent;
            const name = document.getElementById('spec-name').textContent;
            const length = parseFloat(document.getElementById('length').value);
            const topDiameter = parseFloat(document.getElementById('topDiameter').value);
            const bottomDiameter = parseFloat(document.getElementById('bottomDiameter').value);
            const thickness = parseFloat(document.getElementById('thickness').value);
            
            const radiusDiff = (bottomDiameter - topDiameter) / 2;
            const taperAngle = Math.atan(radiusDiff / length) * (180 / Math.PI);
            const taperRatio = (bottomDiameter / topDiameter).toFixed(2);
            
            let colorText = '';
            for (let i = 0; i < NUM_SECTIONS; i++) {
                const pantone = hexToPantone(sectionColors[i]);
                const startMm = (i * SECTION_HEIGHT).toFixed(1);
                const endMm = ((i + 1) * SECTION_HEIGHT).toFixed(1);
                const sectionMidpoint = (i + 0.5) * SECTION_HEIGHT;
                const diameterAtSection = topDiameter + (bottomDiameter - topDiameter) * (sectionMidpoint / length);
                
                colorText += `Section ${i + 1} (${startMm}-${endMm}mm, √ò${diameterAtSection.toFixed(2)}mm): ${sectionColors[i].toUpperCase()}\n  Pantone: ${pantone}\n`;
            }
            
            const designText = `FERRULE DESIGN SPECIFICATION
================================
SKU: ${sku}
DESIGN NAME: ${name}
DATE: ${new Date().toLocaleString()}

GEOMETRY:
Length: ${length} mm
Top Diameter: ${topDiameter} mm
Bottom Diameter: ${bottomDiameter} mm
Taper Angle: ${taperAngle.toFixed(2)}¬∞
Taper Ratio: ${taperRatio}:1
Wall Thickness: ${thickness} mm

COLORS (${SECTION_HEIGHT}mm per section):
${colorText}
================================`;
            
            const blob = new Blob([designText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ferrule-spec-${sku}-${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Specifications saved!');
        }

        function exportImage() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const sku = document.getElementById('spec-sku').textContent;
            
            canvas.width = 1400;
            canvas.height = 1200;
            
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            const topWidth = 200;
            const bottomWidth = 600;
            const ferruleHeight = 900;
            const offsetX = 150;
            const offsetY = (canvas.height - ferruleHeight) / 2;
            const sectionHeight = ferruleHeight / NUM_SECTIONS;
            
            for (let i = 0; i < NUM_SECTIONS; i++) {
                const y1 = offsetY + (i * sectionHeight);
                const y2 = offsetY + ((i + 1) * sectionHeight);
                const yMid = (y1 + y2) / 2;
                
                const progress1 = i / NUM_SECTIONS;
                const progress2 = (i + 1) / NUM_SECTIONS;
                const width1 = topWidth + (bottomWidth - topWidth) * progress1;
                const width2 = topWidth + (bottomWidth - topWidth) * progress2;
                
                const centerX = offsetX + bottomWidth / 2;
                const x1Left = centerX - width1 / 2;
                const x1Right = centerX + width1 / 2;
                const x2Left = centerX - width2 / 2;
                const x2Right = centerX + width2 / 2;
                
                ctx.fillStyle = sectionColors[i];
                ctx.beginPath();
                ctx.moveTo(x1Left, y1);
                ctx.lineTo(x1Right, y1);
                ctx.lineTo(x2Right, y2);
                ctx.lineTo(x2Left, y2);
                ctx.closePath();
                ctx.fill();
                
                // Lines and labels...
                const rightLineEnd = x2Right + 250;
                ctx.strokeStyle = '#333333';
                ctx.beginPath();
                ctx.moveTo(x2Right, yMid);
                ctx.lineTo(rightLineEnd, yMid);
                ctx.stroke();
                
                ctx.fillStyle = '#000000';
                ctx.textAlign = 'left';
                ctx.font = 'bold 20px Arial';
                ctx.fillText(`Section ${i + 1}`, rightLineEnd + 10, yMid - 5);
                ctx.font = 'bold 18px Arial';
                ctx.fillText(`Pantone ${hexToPantone(sectionColors[i])}`, rightLineEnd + 10, yMid + 22);
            }
            
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 36px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`FERRULE DESIGN: ${sku}`, canvas.width / 2, 50);
            
            canvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ferrule-design-${sku}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                alert('‚úÖ Image exported!');
            });
        }

        function initPresetColors() {
            const container = document.getElementById('presetColors');
            presetSchemes.forEach(scheme => {
                const button = document.createElement('div');
                button.className = 'preset-color';
                button.setAttribute('data-name', scheme.name);
                
                let gradientStops = [];
                for (let i = 0; i < scheme.colors.length; i++) {
                    const percent1 = (i / scheme.colors.length) * 100;
                    const percent2 = ((i + 1) / scheme.colors.length) * 100;
                    gradientStops.push(`${scheme.colors[i]} ${percent1}%`);
                    gradientStops.push(`${scheme.colors[i]} ${percent2}%`);
                }
                
                button.style.background = `linear-gradient(to bottom, ${gradientStops.join(', ')})`;
                button.onclick = () => loadPresetScheme(scheme);
                container.appendChild(button);
            });
        }

        ['length', 'topDiameter', 'bottomDiameter', 'thickness'].forEach(id => {
            document.getElementById(id).addEventListener('input', updateDimension);
        });

        window.addEventListener('DOMContentLoaded', () => {
            initializeSections();
            initPresetColors();
            updateDimension();
        });
    </script>
</body>
</html>
